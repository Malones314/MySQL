# MySQL的逻辑架构
## Server层
### 连接器

负责跟客户端建立连接、获取权限、维持和管理连接。
**mysql -h主机地址 -u用户名 -p用户密码**
p后可直接写密码，但可能造成密码泄露
```sql
eg:
主机的IP为：10.0.0.1，用户名为root,密码为123：
mysql -h10.0.0.1 -uroot -p
Enter password:123
```

一个用户成功建立连接后，即使管理员账号对这个用户的权限做了修改，也不会影响已经存
在连接的权限。修改完成后，只有再新建的连接才会使用新的权限设置。

#### 连接
##### 长连接

连接成功后如果客户端持续有请求则一直使用同一个连接

##### 短链接

每次执行完很少几次查询就断开连接，下次查询**重新建立连接**


连接通常比较复杂繁琐，应当尽量使用**长连接**，但如果全部使用长连接则MySQL占用内存涨的很快，因为MySQL在执行过程中临时使用的内存管理在连接对象中，资源在断开连接时才释放，如果长连接累积, 导致内存占用太大，被系统强行杀掉(OOM)，看上去就是MySQL**异常重启。**

##### 解决方法
**1.** 定期断开长连接，使用一段时间，或者程序里面判断执行过一个占用内存的查询后，断开连接，之后等要查询时再重新连接。
**2.** MySQL5.7以上版本可以每次执行一个较大的操作后，通过执行mysql_reset_connection来重新初始化连接资源，此过程不需要重连和重新坐权限验证，但是会将连接恢复到刚刚创建完时的状态。

### 查询缓存

MySQL在拿到查询时，会先看看查询缓存，看看之前是否执行过这条语句(之前执行过的语句可能会以Key-Value的形式直接被缓存在内存中，**如果结果在缓存中**则value会直接返回到客户端；**如果结果不在缓存中**则执行后面的阶段(分析器、优化器、执行器)）。

虽然使用查询缓存后查询效率很高，但是不建议使用，因为**失败概率很大**。只要对表上的一个内容更新，**整张表的查询缓存**都被清空。除非是很长时间才更新一次的静态表。

注：MySQL8.0之后的查询缓存已经被删除了。

### 分析器

先做词法分析后做语法分析

### 优化器
在表里有多个索引时判断使用哪一个索引，或在一个语句有多个关联(join)时确定各个表的**连接顺序**(让其正确、高效)。

### 执行器
分析器告诉你做什么，优化器告诉你怎么做，执行器则是执行语句。执行时会判断你对这个表是否有执行相关语句的权限，如果没有则报错返回，如果有则执行。

## 存储引擎层


